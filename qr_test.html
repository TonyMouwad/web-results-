<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù‚Ø§Ø±Ø¦ QR Ø¨Ø§Ù„Ø²ÙˆÙˆÙ…</title>
  <style>
    body {
      background: #000;
      color: #fff;
      text-align: center;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    video {
      width: 90%;
      max-width: 500px;
      border-radius: 12px;
      margin-top: 10px;
    }
    #controls {
      margin: 10px;
    }
    input[type=range] {
      width: 80%;
    }
  </style>
</head>
<body>
  <h2>ğŸ“· Ù‚Ø§Ø±Ø¦ QR Ø¨ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</h2>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" style="display:none;"></canvas>
  <div id="controls">
    ğŸ” Ø§Ù„Ø²ÙˆÙˆÙ…:
    <input type="range" id="zoomSlider" min="1" max="3" step="0.1" value="1">
    <span id="zoomValue">1x</span>
  </div>
  <p id="status">Ø¬Ø§Ø±Ù Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...</p>

  <script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
  <script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const zoomSlider = document.getElementById("zoomSlider");
    const zoomValue = document.getElementById("zoomValue");
    const status = document.getElementById("status");

    let zoom = 1;

    async function initCamera() {
      try {
        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©
        const stream = await navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: { ideal: "environment" },
            width: { ideal: 1280 },
            height: { ideal: 720 }
          }
        });

        video.srcObject = stream;
        video.setAttribute("playsinline", true); // Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ø¢ÙŠÙÙˆÙ†
        status.textContent = "âœ… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†";
        requestAnimationFrame(scan);
      } catch (err) {
        console.error(err);
        status.textContent = "âŒ ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + err.message;
      }
    }

    zoomSlider.addEventListener("input", () => {
      zoom = parseFloat(zoomSlider.value);
      zoomValue.textContent = zoom.toFixed(1) + "x";
    });

    function scan() {
      if (video.readyState === video.HAVE_ENOUGH_DATA) {
        const width = video.videoWidth;
        const height = video.videoHeight;
        canvas.width = width;
        canvas.height = height;

        const zoomedWidth = width / zoom;
        const zoomedHeight = height / zoom;
        const x = (width - zoomedWidth) / 2;
        const y = (height - zoomedHeight) / 2;

        ctx.drawImage(video, x, y, zoomedWidth, zoomedHeight, 0, 0, width, height);

        const imageData = ctx.getImageData(0, 0, width, height);
        const code = jsQR(imageData.data, width, height);
        if (code) {
          status.textContent = "âœ… QR: " + code.data;
        }
      }
      requestAnimationFrame(scan);
    }

    // Ø¨Ø¯Ø£ Ø§Ù„ØªØ´ØºÙŠÙ„
    initCamera();
  </script>
</body>
</html>
